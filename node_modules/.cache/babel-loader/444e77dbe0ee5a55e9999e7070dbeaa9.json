{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs2/helpers/interopRequireDefault\");\n\nvar _stringify = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/json/stringify\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime-corejs2/regenerator\"));\n\nvar _parseInt2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/parse-int\"));\n\nvar _getIterator2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/core-js/get-iterator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\"));\n\n//require('dotenv').config();\nvar fetch = require('isomorphic-fetch');\n\nvar restApiPath = 'https://localhost:4000/api/post/bulk';\n\nfunction callAsync(_x, _x2, _x3, _x4, _x5) {\n  return _callAsync.apply(this, arguments);\n}\n\nfunction _callAsync() {\n  _callAsync = (0, _asyncToGenerator2.default)(\n  /*#__PURE__*/\n  _regenerator.default.mark(function _callee(url, descStart, descEnd, priceColumn, hospital) {\n    var response, data, formattedData;\n    return _regenerator.default.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return fetch(url);\n\n          case 2:\n            response = _context.sent;\n            _context.next = 5;\n            return response.text();\n\n          case 5:\n            data = _context.sent;\n            formattedData = transformer(data, descStart, descEnd, priceColumn, hospital);\n            console.log(formattedData);\n            return _context.abrupt(\"return\", formattedData);\n\n          case 9:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _callAsync.apply(this, arguments);\n}\n\nfunction givePreview(data) {\n  var preview = [];\n  console.log(data[0]); // pick out three random elements of JSON array\n\n  var rand1 = Math.random() * data.length;\n  var rand2 = Math.random() * data.length;\n  var rand3 = Math.random() * data.length;\n  preview.push(data[rand1], data[rand2], data[rand3]);\n  return preview;\n}\n\nfunction transformer(data, descStart, descEnd, priceColumn, hospital) {\n  var readyVals = []; // separate into lines\n\n  var lines = returnLines(data); // JSON populate\n\n  var _iteratorNormalCompletion = true;\n  var _didIteratorError = false;\n  var _iteratorError = undefined;\n\n  try {\n    for (var _iterator = (0, _getIterator2.default)(lines), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n      var line = _step.value;\n      var jsonReady = groupDataReturnRecord(line, descStart, descEnd, priceColumn);\n      jsonReady['hospital'] = hospital;\n      readyVals.push(jsonReady); //console.log(jsonReady);\n    }\n  } catch (err) {\n    _didIteratorError = true;\n    _iteratorError = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion && _iterator.return != null) {\n        _iterator.return();\n      }\n    } finally {\n      if (_didIteratorError) {\n        throw _iteratorError;\n      }\n    }\n  }\n\n  return readyVals;\n}\n\nfunction returnLines(data) {\n  // works: 2:40pm\n  var lines = [];\n  var _iteratorNormalCompletion2 = true;\n  var _didIteratorError2 = false;\n  var _iteratorError2 = undefined;\n\n  try {\n    for (var _iterator2 = (0, _getIterator2.default)(data.split('\\n')), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n      var line = _step2.value;\n      lines.push(line.replace(/\\s+/g, ' ')); // trimmed extra spaces\n    }\n  } catch (err) {\n    _didIteratorError2 = true;\n    _iteratorError2 = err;\n  } finally {\n    try {\n      if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n        _iterator2.return();\n      }\n    } finally {\n      if (_didIteratorError2) {\n        throw _iteratorError2;\n      }\n    }\n  }\n\n  lines.pop(); // there's always an empty element created at end, remove it\n\n  return lines;\n}\n\nfunction groupDataReturnRecord(line, descStart, descEnd, priceColumn) {\n  // create arr\n  var arr = line.split(\" \");\n  arr.pop(); // there's always an empty element created at end, remove it\n\n  var record = {\n    hospital: '',\n    procedureName: '',\n    procedureCost: ''\n  };\n  var cost = arr[arr.length + (0, _parseInt2.default)(priceColumn)]; // probably -2 position\n  // convert relative negative pos for descEnd to positive for this array\n\n  var positiveEnd = arr.indexOf(arr[arr.length + (0, _parseInt2.default)(descEnd)]); // remap\n\n  var description = arr.map(function (word, pos) {\n    if (pos >= (0, _parseInt2.default)(descStart) && pos <= positiveEnd) {\n      return word;\n    }\n  });\n  record['procedureName'] = description.join(\" \").trim();\n  record['procedureCost'] = cost; //console.log(cost);\n\n  return record;\n}\n\nfunction postToApi(_x6) {\n  return _postToApi.apply(this, arguments);\n}\n\nfunction _postToApi() {\n  _postToApi = (0, _asyncToGenerator2.default)(\n  /*#__PURE__*/\n  _regenerator.default.mark(function _callee2(data) {\n    var post, request;\n    return _regenerator.default.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return fetch(restApiPath, {\n              method: 'POST',\n              body: (0, _stringify.default)({\n                hospital: data.hospital,\n                procedureName: data.procedureName,\n                procedureCost: data.procedureCost\n              }),\n              headers: {\n                'Content-Type': 'application/json'\n              }\n            });\n\n          case 2:\n            post = _context2.sent;\n            _context2.next = 5;\n            return response.json();\n\n          case 5:\n            request = _context2.sent;\n            console.log(request);\n\n          case 7:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _postToApi.apply(this, arguments);\n}\n\nmodule.exports.callAsync = callAsync;","map":null,"metadata":{},"sourceType":"script"}